import{d as be,r as l,dK as Ve,j as e,S as Ge,I as je,D as ae,dL as ra,x as I,dM as da,bu as ma,G as Q,dN as ye,bj as De,dO as va,dP as ua,M as Ee,cH as fa,B as q,T as re,co as ga,dQ as pa,dR as xa,dS as ha,dT as _a,dU as ya,dk as Ca}from"./index-ChJwsExv.js";import{f as ee}from"./icon_nav_dropdown-B-gtXUyP.js";import{U as ja}from"./uuid-Q0OBPXtL.js";import{g as Ce}from"./globalStore-__M3ATz8.js";import{d as ba}from"./common-Cw0C9a7_.js";import{u as Na}from"./icon_zhishi_upload_act-D7BMkVq5.js";import{p as wa}from"./ai_chat_placeholder-ChZYJ5lQ.js";import{c as ka}from"./modal-close-QVlieQPY.js";import{f as Ia,a as Sa}from"./flowId-copy-icon-oUh8DYIQ.js";import{U as Ma}from"./index-DOFwIa6F.js";const La="/assets/ai_create-FIhi3KcY.svg",de="/assets/help-icon-Zxip3zS7.svg",Re="/assets/default-avatar-DuLPbLi6.png",Aa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20fill='none'%20version='1.1'%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%3e%3cdefs%3e%3cclipPath%20id='master_svg0_107_00401'%3e%3crect%20x='0'%20y='0'%20width='32'%20height='32'%20rx='0'/%3e%3c/clipPath%3e%3c/defs%3e%3cg%20clip-path='url(%23master_svg0_107_00401)'%3e%3cg%3e%3cg%3e%3crect%20x='0'%20y='0'%20width='32'%20height='32'%20rx='0'%20fill='%23FFFFFF'%20fill-opacity='0.009999999776482582'%20style='mix-blend-mode:passthrough'/%3e%3c/g%3e%3cg%3e%3cpath%20d='M12.66667,5L9.63636,5Q9.51289,5,9.39313,5.030032Q9.27337,5.060065,9.16451,5.1183250000000005Q9.05564,5.176586,8.964220000000001,5.259576Q8.8728,5.342566,8.804310000000001,5.4453L5.16795,10.89985Q5.117536,10.97547,5.081581,11.05894Q5.045626,11.14241,5.025309,11.23099Q5.004991,11.31958,5.000976,11.41037Q4.99696,11.50117,5.009381,11.5912Q5.021801,11.68123,5.050249,11.76755Q5.078696,11.85387,5.122239,11.93364Q5.165781,12.01342,5.222992,12.08404Q5.280204,12.15466,5.349209,12.213799999999999L8.18182,14.64175L8.18182,26Q8.18182,26.0985,8.20103,26.1951Q8.22025,26.2917,8.25794,26.3827Q8.29563,26.4737,8.35035,26.5556Q8.40507,26.6375,8.47471,26.7071Q8.544360000000001,26.7767,8.62625,26.8315Q8.70814,26.8862,8.79913,26.9239Q8.89013,26.9616,8.98673,26.9808Q9.08333,27,9.18182,27L22.8182,27Q22.9167,27,23.0133,26.9808Q23.1099,26.9616,23.2009,26.9239Q23.2919,26.8862,23.3738,26.8315Q23.4556,26.7767,23.5253,26.7071Q23.5949,26.6375,23.6497,26.5556Q23.7044,26.4737,23.7421,26.3827Q23.7798,26.2917,23.799,26.1951Q23.8182,26.0985,23.8182,26L23.8182,14.64175L26.6508,12.213799999999999Q26.7198,12.15466,26.777,12.08404Q26.8342,12.01342,26.8778,11.93364Q26.9213,11.85387,26.9498,11.76755Q26.9782,11.68123,26.9906,11.5912Q27.003,11.50117,26.999,11.41037Q26.995,11.31958,26.9747,11.23099Q26.9544,11.14241,26.9184,11.05894Q26.8825,10.97547,26.8321,10.89985L23.1957,5.4453Q23.1272,5.342566,23.0358,5.259576Q22.9444,5.176586,22.8355,5.1183250000000005Q22.7266,5.060065,22.6069,5.030032Q22.4871,5,22.3636,5L19.3333,5Q19.2348,5,19.138199999999998,5.019215Q19.041600000000003,5.03843,18.9506,5.076121Q18.8597,5.113812,18.7778,5.16853Q18.6959,5.223249,18.6262,5.292893Q18.5566,5.362537,18.5019,5.44443Q18.4471,5.526322,18.4095,5.617317Q18.3718,5.708311,18.3525,5.80491Q18.3333,5.9015086,18.3333,6Q18.3333,6.966498,17.649900000000002,7.64992Q16.9665,8.33333,16,8.33333Q13.66667,8.33333,13.66667,6Q13.66667,5.9015086,13.64745,5.80491Q13.62824,5.708311,13.59055,5.617317Q13.552859999999999,5.526322,13.49814,5.44443Q13.44342,5.362537,13.37377,5.292893Q13.30413,5.223249,13.22224,5.16853Q13.14034,5.113812,13.04935,5.076121Q12.958359999999999,5.03843,12.86176,5.019215Q12.76516,5,12.66667,5ZM10.17155,7L7.32357,11.27196L9.832609999999999,13.42256Q9.91475,13.49297,9.97994,13.57932Q10.04512,13.66567,10.09033,13.76396Q10.135539999999999,13.86225,10.15868,13.967939999999999Q10.18182,14.07363,10.18182,14.18182L10.18182,25L21.818199999999997,25L21.818199999999997,14.18182Q21.818199999999997,14.07363,21.8413,13.967939999999999Q21.8645,13.86225,21.9097,13.76396Q21.954900000000002,13.66567,22.0201,13.57932Q22.0852,13.49297,22.1674,13.42256L24.6764,11.27196L21.8285,7L20.2259,7Q19.964,8.16421,19.0641,9.06413Q17.7949,10.33333,16,10.33333Q14.20507,10.33333,12.935870000000001,9.06413Q12.03596,8.16421,11.77412,7L10.17155,7Z'%20fill-rule='evenodd'%20fill='%239CA3AF'%20fill-opacity='1'%20style='mix-blend-mode:passthrough'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Ue="/assets/voice-icon-CgJo5QVo.svg",Ta="/assets/edit-voice-Bx032D71.svg",Qa="/assets/default-modal-avatar-DJPYVfej.png",Fa="/assets/default-modal-avatar-preview-CafJYNnR.png",Pa="_open_source_modal_cnek9_6",Ba="_modal_content_cnek9_15",Ha="_title_cnek9_26",Va="_scrollable_content_cnek9_36",Da="_inputBottom_cnek9_42",Ea="_aiBottom_cnek9_51",Ra="_form_select_cnek9_150",Ua="_footerContiner_cnek9_153",Ga="_footerContinerLeft_cnek9_159",Oa="_footerContinerRight_cnek9_162",$a="_cancelBtn_cnek9_167",Wa="_submitBtn_cnek9_179",za="_sectionHeader_cnek9_198",Ja="_sectionTitle_cnek9_204",Ka="_sectionHelp_cnek9_209",Za="_sectionHeaderHelp_cnek9_214",Xa="_configSection_cnek9_223",Ya="_toggleRow_cnek9_254",qa="_toggleLabel_cnek9_260",et="_toggleSwitch_cnek9_271",at="_toggleSwitchItem_cnek9_280",tt="_toggleSwitchItemActive_cnek9_298",nt="_summaryRow_cnek9_304",st="_summaryLeft_cnek9_327",lt="_summaryAvatar_cnek9_332",it="_summaryName_cnek9_337",ot="_summaryNameText_cnek9_347",ct="_summaryAction_cnek9_372",rt="_summaryActionVcn_cnek9_376",dt="_optionInfo_cnek9_397",mt="_voicePill_cnek9_413",vt="_voiceIcon_cnek9_420",ut="_voiceSection_cnek9_496",ft="_avatarModalWrap_cnek9_501",gt="_avatarModalHeader_cnek9_507",pt="_avatarModalTitle_cnek9_510",xt="_avatarModalBody_cnek9_518",ht="_avatarListPane_cnek9_524",_t="_avatarFilterRow_cnek9_529",yt="_filterSelect_cnek9_543",Ct="_filterLabel_cnek9_554",jt="_avatarGrid_cnek9_558",bt="_avatarItem_cnek9_565",Nt="_avatarItemThumb_cnek9_574",wt="_avatarItemDisabled_cnek9_587",kt="_avatarItemActive_cnek9_597",It="_avatarName_cnek9_600",St="_avatarPreviewPane_cnek9_608",Mt="_avatarPreviewCard_cnek9_614",Lt="_avatarPreviewHeader_cnek9_625",At="_previewName_cnek9_628",Tt="_avatarPreviewImage_cnek9_661",Qt="_avatarPreviewImageXuniren_cnek9_667",Ft="_avatarPreviewCaption_cnek9_671",Pt="_avatarModalFooter_cnek9_677",Bt="_inputField_cnek9_684",Ht="_input_area_cnek9_688",Vt="_nameAndType_cnek9_705",Dt="_form_avatar_cnek9_711",Et="_teamAvatar_cnek9_718",t={open_source_modal:Pa,modal_content:Ba,title:Ha,scrollable_content:Va,inputBottom:Da,aiBottom:Ea,form_select:Ra,footerContiner:Ua,footerContinerLeft:Ga,footerContinerRight:Oa,cancelBtn:$a,submitBtn:Wa,sectionHeader:za,sectionTitle:Ja,sectionHelp:Ka,sectionHeaderHelp:Za,configSection:Xa,toggleRow:Ya,toggleLabel:qa,toggleSwitch:et,toggleSwitchItem:at,toggleSwitchItemActive:tt,summaryRow:nt,summaryLeft:st,summaryAvatar:lt,summaryName:it,summaryNameText:ot,summaryAction:ct,summaryActionVcn:rt,optionInfo:dt,voicePill:mt,voiceIcon:vt,voiceSection:ut,avatarModalWrap:ft,avatarModalHeader:gt,avatarModalTitle:pt,avatarModalBody:xt,avatarListPane:ht,avatarFilterRow:_t,filterSelect:yt,filterLabel:Ct,avatarGrid:jt,avatarItem:bt,avatarItemThumb:Nt,avatarItemDisabled:wt,avatarItemActive:kt,avatarName:It,avatarPreviewPane:St,avatarPreviewCard:Mt,avatarPreviewHeader:Lt,previewName:At,avatarPreviewImage:Tt,avatarPreviewImageXuniren:Qt,avatarPreviewCaption:Ft,avatarModalFooter:Pt,inputField:Bt,input_area:Ht,nameAndType:Vt,form_avatar:Dt,teamAvatar:Et},{Dragger:nn}=Ma;function Rt(W){const{inputRef:o,uploadedSrc:N,setUploadedSrc:F,blobData:n,setBlobData:E}=W,{t:w}=be(),[r,u]=l.useState({x:0,y:0}),[R,L]=l.useState(1),_=(d,m,c)=>new Promise((p,y)=>{new ma(d,{quality:m,convertSize:c,success(C){const x=new File([C],C.name,{type:C.type,lastModified:C.lastModified});p(x)},error(C){console.log(C.message),y(C)}})}),j=async d=>{if(d.target.files&&d.target.files.length>0){const m=d.target.files[0];if(m.type.startsWith("image/")){if(m.size>5*1024*1024){I.error(w("configBase.fileSizeCannotExceed5MB"));return}const c=await _(m,.2,1e6),p=new FileReader;p.addEventListener("load",()=>{F(p.result)}),p.readAsDataURL(c)}else I.error(w("configBase.onlyUploadImage"))}},b=(d,m)=>{const c=new Image;c.src=N||"",c.onload=()=>{const p=document.createElement("canvas");p.width=m.width,p.height=m.height;const y=p.getContext("2d");y&&y.drawImage(c,m.x*(c.width/c.naturalWidth),m.y*(c.height/c.naturalHeight),m.width*(c.width/c.naturalWidth),m.height*(c.height/c.naturalHeight),0,0,m.width,m.height),p.toBlob(C=>{E(C)},"image/jpeg",1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex items-center justify-center",children:e.jsx("input",{type:"file",accept:"image/*",ref:o,onChange:j,style:{display:"none"}})}),e.jsx("div",{className:"flex items-center w-full",children:N&&e.jsx("div",{className:"flow-avatar-cropper",children:e.jsx(ra,{image:N,crop:r,zoom:R,aspect:1,onCropChange:u,onCropComplete:b,onZoomChange:L})})})]})}function Ut(W){const{icons:o,colors:N,botIcon:F,setBotIcon:n,botColor:E,setBotColor:w,setShowModal:r}=W,{t:u}=be(),R=l.useRef(null),[L,_]=l.useState({}),[j,b]=l.useState(""),[d,m]=l.useState("upload"),[c,p]=l.useState(""),[y,C]=l.useState(""),[x,P]=l.useState(""),[k,z]=l.useState({downloadLink:"",s3Key:""}),[f,B]=l.useState(!1),[te,U]=l.useState(""),[me,J]=l.useState(!1);l.useEffect(()=>{E?(_({...F}),b(E)):(_(o[0]),b(N[0].name))},[]);function K(){if(!f){if(!(x!=null&&x.trim())){I.error(u("virtualConfig.iconModal.rulesDesc"));return}B(!0),ba(x).then(s=>{z(s)}).finally(()=>B(!1))}}function G(){if(d==="upload"){const s={...F},g={file:te};J(!0),da(g).then(A=>{s.value=A==null?void 0:A.downloadUrl,n(s.value),r(!1)}).finally(()=>J(!1))}else n(k.downloadLink),r(!1)}const S=l.useMemo(()=>d==="upload"&&!y||d==="chat"&&!k.downloadLink,[d,y,k]),H=l.useMemo(()=>Ve.filter(s=>s.activeTab!=="gallery"),[Ve]),Z=()=>{R.current.click()};return e.jsx("div",{className:"mask text-second text-sm font-medium z-[1011]",children:e.jsxs("div",{className:"p-6 absolute bg-[#fff] rounded-2xl top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 text-second font-medium text-md w-[720px]",children:[e.jsxs("div",{className:"text-second text-base font-semibold mb-4 flex items-center justify-between",children:[e.jsx("span",{children:u("virtualConfig.iconModal.selectIcon")}),e.jsx("img",{src:ka,className:"w-3 h-3 cursor-pointer",alt:"",onClick:()=>r(!1)})]}),e.jsx("div",{className:"flex items-center gap-4",children:H.map((s,g)=>e.jsxs("div",{className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg cursor-pointer ${[d,c].includes(s.activeTab)?"text-[#6356ea] bg-[#F6F9FF]":""}`,onMouseEnter:()=>p(s.activeTab),onMouseLeave:()=>p(""),onClick:()=>m(s.activeTab),children:[e.jsx("img",{src:[d,c].includes(s.activeTab)?s.iconAct:s.icon,className:"w-[18px] h-[18px]",alt:""}),e.jsx("span",{className:"font-medium",children:s.title})]},g))}),d==="gallery"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-[160px] overflow-auto mt-7",children:[e.jsx("div",{className:"text-[#101828] text-xs font-medium mb-1",children:u("virtualConfig.iconModal.commonIcon")}),e.jsx("div",{className:"flex gap-4 flex-wrap",children:o.filter(s=>s.code==="common").map((s,g)=>e.jsx("div",{className:"icons-item cursor-pointer",style:{background:L.value===s.value?j:""},onClick:()=>_(s),children:e.jsx("img",{src:s.name+s.value,className:"w-8 h-8",alt:""})},g))}),e.jsx("div",{className:"text-[#101828] text-xs font-medium mb-1 mt-7",children:u("virtualConfig.iconModal.sportIcon")}),e.jsx("div",{className:"flex gap-4 flex-wrap",children:o.filter(s=>s.code==="sport").map((s,g)=>e.jsx("div",{className:"icons-item cursor-pointer",style:{background:L.value===s.value?j:""},onClick:()=>_(s),children:e.jsx("img",{src:s.name+s.value,className:"w-8 h-8",alt:""})},g))}),e.jsx("div",{className:"text-[#101828] text-xs font-medium mb-1 mt-7",children:u("virtualConfig.iconModal.plantIcon")}),e.jsx("div",{className:"flex gap-4 flex-wrap",children:o.filter(s=>s.code==="plant").map((s,g)=>e.jsx("div",{className:"icons-item cursor-pointer",style:{background:L.value===s.value?j:""},onClick:()=>_(s),children:e.jsx("img",{src:s.name+s.value,className:"w-8 h-8",alt:""})},g))}),e.jsx("div",{className:"text-[#101828] text-xs font-medium mb-1 mt-7",children:u("virtualConfig.iconModal.exploreIcon")}),e.jsx("div",{className:"flex gap-4 flex-wrap",children:o.filter(s=>s.code==="explore").map((s,g)=>e.jsx("div",{className:"icons-item cursor-pointer",style:{background:L.value===s.value?j:""},onClick:()=>_(s),children:e.jsx("img",{src:s.name+s.value,className:"w-8 h-8",alt:""})},g))})]}),e.jsx("div",{className:"text-[#101828] text-xs font-medium mb-1 mt-7",children:u("virtualConfig.iconModal.styleIcon")}),e.jsx("div",{className:"flex mt-2 gap-1",children:N.map((s,g)=>e.jsx("div",{className:`w-[40px] h-[40px] flex justify-center items-center ${s.name===j?"color-item-active":""} cursor-pointer`,onClick:()=>b(s.name),children:e.jsx("span",{className:"w-[30px] h-[30px] rounded-lg",style:{background:s.name}})},g))})]}),d==="upload"&&e.jsxs("div",{className:"mt-8",children:[!y&&e.jsxs("div",{className:"border border-[#e5e7eb] hover:border-[#6356ea] px-6 py-10 flex flex-col items-center cursor-pointer bg-[#f8faff] rounded-lg",onClick:Z,children:[e.jsx("img",{src:Na,className:"w-8 h-8",alt:""}),e.jsxs("div",{className:"font-medium mt-6",children:[u("virtualConfig.iconModal.dragFile"),e.jsx("span",{className:"text-[#6356ea]",children:u("virtualConfig.iconModal.selectFile")})]}),e.jsx("p",{className:"text-desc mt-2",children:u("virtualConfig.iconModal.fileTip")})]}),e.jsx(Rt,{inputRef:R,uploadedSrc:y,setUploadedSrc:C,blobData:te,setBlobData:U}),y&&e.jsxs("div",{className:"mt-6 flex items-center gap-2 text-[#6356ea] cursor-pointer",onClick:Z,children:[e.jsx("img",{src:Ia,className:"w-4 h-4",alt:""}),e.jsx("span",{children:u("virtualConfig.iconModal.reSelect")})]})]}),d==="chat"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"w-full h-[165px] flex items-center justify-center rounded-lg",style:{background:"linear-gradient(90deg, rgba(223, 231, 253, 0.26) 0%, rgba(239, 227, 253, 0.81) 100%)",border:"1px solid #E4EAFF"},children:e.jsx(Ge,{spinning:f,children:e.jsx("img",{src:k.downloadLink?k.downloadLink:wa,className:"w-[88px] h-[88px] rounded-md",alt:""})})}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(je,{className:"user-chat-input w-full",maxLength:80,value:x,onChange:s=>P(s.target.value),onPressEnter:s=>{s.stopPropagation(),s.preventDefault(),K()},placeholder:u("virtualConfig.iconModal.placeholderDesc")}),e.jsx("div",{className:"send-btns",children:e.jsx("span",{onClick:()=>K(),className:"ai-chat-img"})})]})]}),e.jsxs("div",{className:"flex flex-row-reverse gap-3 mt-7",children:[e.jsx(ae,{type:"primary",disabled:S,className:"px-[24px]",onClick:G,loading:me,children:u("virtualConfig.iconModal.save")}),e.jsx(ae,{type:"text",className:"origin-btn px-[24px]",onClick:()=>r(!1),children:u("virtualConfig.iconModal.cancel")})]})]})})}const sn=({visible:W,formValues:o,onSubmit:N,onCancel:F})=>{var Me,Le,Ae,Te,Qe,Fe,Pe;const{t:n}=be(),[E,w]=l.useState(!1),[r]=Q.useForm(),[u,R]=l.useState([]),[L,_]=l.useState(!1),[j,b]=l.useState(!0),[d,m]=l.useState(""),[c,p]=l.useState([]),[y,C]=l.useState(!0),[x,P]=l.useState((Me=ye[0])==null?void 0:Me.vcn),[k,z]=l.useState(""),[f,B]=l.useState(0),[te,U]=l.useState(""),[me,J]=l.useState(!1),[K,G]=l.useState(!1),[S,H]=l.useState(""),[Z,s]=l.useState(""),[g,A]=l.useState({cn:(Le=ye[0])==null?void 0:Le.vcn,en:(Ae=ye[0])==null?void 0:Ae.vcn,emotion:""}),[Gt,ve]=l.useState(null),[ne,ue]=l.useState("all"),[se,fe]=l.useState("all"),[le,ge]=l.useState("all"),[Oe,pe]=l.useState(""),[$e,Ot]=l.useState("cn"),[We,$t]=l.useState(""),[ze,ie]=l.useState(!1),Je=()=>ja.genV4().toString().replace(/-/g,"").substring(0,6),M=Ce(a=>a.avatarIcon),O=Ce(a=>a.avatarColor),Ke=Ce(a=>a.getAvatarConfig),Ze=()=>{if(!(M!=null&&M.length)||!(O!=null&&O.length))return{avatar:"https://oss-beijing-m8.openstorage.cn/SparkBotProd/icon/common/emojiitem_00_10@2x.png",avatarColor:"#FFEAD5"};const a=Math.floor(Math.random()*M.length),i=Math.floor(Math.random()*O.length),{name:v,value:h}=M[a],D=O[i];return{avatar:v+h,avatarColor:D.name}},[V,Ne]=l.useState(Ze().avatar),[Xe,we]=l.useState(!1),ke=De(a=>a.officialVcnList),Ye=De(a=>a.setOfficialVcnList);let X=[{avatar:"https://openres.xfyun.cn/xfyundoc/2024-10-21/0969f0d7-519b-45c0-b006-2765fa8f79f7/1729496233283/lingxiaoyue.jpg",defaultVCN:"x5_lingxiaoyue_flow",gender:n("virtualConfig.defVcnList.gender1"),name:n("virtualConfig.defVcnList.name1"),posture:n("virtualConfig.defVcnList.posture"),sceneId:"avatar_wmy001",type:[n("virtualConfig.defVcnList.scene")],sampleAvatar:"https://openres.xfyun.cn/xfyundoc/2024-10-21/0969f0d7-519b-45c0-b006-2765fa8f79f7/1729496233283/lingxiaoyue.jpg"},{avatar:"https://openres.xfyun.cn/xfyundoc/2025-01-10/072d1c04-b23b-4feb-9728-091207773145/1736479064040/20250110-111727.jpg",defaultVCN:"x5_lingfeiyi_flow",gender:n("virtualConfig.defVcnList.gender2"),name:n("virtualConfig.defVcnList.name2"),posture:n("virtualConfig.defVcnList.posture"),sceneId:"avatar_lfy",type:[n("virtualConfig.defVcnList.scene")],sampleAvatar:"https://openres.xfyun.cn/xfyundoc/2025-01-10/072d1c04-b23b-4feb-9728-091207773145/1736479064040/20250110-111727.jpg"}];const Y=l.useMemo(()=>f===0?c:X,[f,c,X]),$=l.useMemo(()=>f===0?d:k,[f,c,X]);l.useEffect(()=>{o&&(r.setFieldValue("name",o.name),r.setFieldValue("botType",o.botType||null),r.setFieldValue("avatar",o.avatar),r.setFieldValue("botDesc",o.botDesc),Ne(o.avatar),_(!1),o.talkAgentConfig&&(r.setFieldValue("interactType",o.talkAgentConfig.interactType),b(o.talkAgentConfig.sceneEnable===1),m(o.talkAgentConfig.sceneId),z(o.talkAgentConfig.callSceneId),C(o.talkAgentConfig.vcnEnable===1),B(o.talkAgentConfig.sceneMode),P(o.talkAgentConfig.vcn),U(o.talkAgentConfig.sceneVcn),A({...g,cn:o.talkAgentConfig.vcn})))},[o]),l.useEffect(()=>{_(!1),V&&r.setFieldValue("avatar",V)},[V]);const Ie=l.useCallback(()=>{ue("all"),fe("all"),ge("all"),H(""),s(""),H($||""),s(x),G(!0)},[f,d,k,x]),Se=l.useCallback(()=>{J(a=>!a),A({...g,cn:x})},[f,x]),qe=l.useCallback(()=>{ue("all"),fe("all"),ge("all"),H(""),s(""),ie(!1),pe(""),ve(null)},[]),[xe,Wt]=l.useState([]),ea=async a=>{const i=((a==null?void 0:a.name)??"").trim(),v=((a==null?void 0:a.botDesc)??"").trim();if(!i){I.error(n("virtualConfig.rulesName"));return}if(!v){I.error(n("virtualConfig.rulesDesc"));return}w(!0);try{const h=typeof(a==null?void 0:a.botType)=="number"?a.botType:Number((a==null?void 0:a.botType)??0),D=typeof(a==null?void 0:a.avatar)=="string"&&a.avatar?a.avatar:"https://oss-beijing-m8.openstorage.cn/SparkBotProd/icon/common/emojiitem_00_10@2x.png",_e={name:i,botType:h,avatar:D,botDesc:v,botId:(o==null?void 0:o.botId)||null,inputExample:(o==null?void 0:o.inputExample)||["","",""],talkAgentConfig:{interactType:r.getFieldValue("interactType")||2,vcn:x||"",vcnEnable:y?1:0,sceneId:d||"",callSceneId:k||"",sceneMode:f,sceneEnable:j?1:0,sceneVcn:te,isDelete:0}};N==null||N(_e),w(!1)}catch(h){const D=typeof h=="object"&&h&&"message"in h?String(h.message):n("virtualConfig.submitFailed");I.error(D),w(!1)}finally{w(!1)}},aa=()=>{const a=r.getFieldValue("botDesc");if(!a)return I.warning(n("virtualConfig.rulesContent"));w(!0),Ca({name:a}).then(i=>{const v=typeof i=="string"?i:JSON.stringify(i);console.log(i,"text",v,r),r.setFieldValue("botDesc",v)}).catch(i=>{I.error((i==null?void 0:i.msg)||n("virtualConfig.aiGenFailed"))}).finally(()=>{w(!1)})},ta=async()=>{let a=await ya();a=a.filter(i=>i.key!==25&&i.key!==26),R(a)},na=async()=>{try{const a=await _a(),i=Array.isArray(a)?a:[];p(i),!d&&i.length>0&&(m(i[0].sceneId),U(i[0].defaultVCN||"")),i.length===0&&I.info(n("virtualConfig.noAvatar"))}catch{p([])}},sa=l.useMemo(()=>{const a={male:"男",female:"女"},i={full:"全身",half:"大半身",sit:"坐姿"},v={ai_host:"AI主播",education:"教育学习",digital_staff:"数字员工",cartoon:"卡通形象",historical:"历史人物"};return Y.filter(h=>{const D=ne==="all"?!0:h.gender===a[ne],_e=se==="all"?!0:h.posture===i[se],ca=le==="all"?!0:(()=>{const oe=v[le],ce=h.type;if(Array.isArray(ce))return ce.some(T=>typeof T=="string"&&T===oe);if(typeof ce=="string"){const T=ce.trim();if(T.startsWith("[")&&T.endsWith("]"))try{const Be=JSON.parse(T);return Array.isArray(Be)&&Be.some(He=>typeof He=="string"&&He===oe)}catch{return T===oe}return T===oe}return!1})();return D&&_e&&ca})},[c,ne,se,le,f]);l.useEffect(()=>{va().then(a=>{var i;Ye(a),P(((i=a[0])==null?void 0:i.vcn)||"")}).catch(a=>{}),na(),ta(),M!=null&&M.length||Ke()},[]);const la=a=>{A(a),P(a.cn)},[he,ia]=l.useState([]),oa=l.useCallback(()=>{let a=[...ke,...ua].find(i=>i.vcn===x);return a||(a=he.find(i=>i.vcnCode===g.cn)),e.jsx(e.Fragment,{children:a?a.name||a.vcnName:n("virtualConfig.defaultVoice")})},[ke,x,he]);return e.jsxs(Ee,{wrapClassName:t.open_source_modal,width:680,open:W,centered:!0,onCancel:F,destroyOnClose:!0,maskClosable:!1,footer:null,styles:{body:{padding:0,maxHeight:"70vh",overflow:"auto"}},children:[e.jsx(Ge,{spinning:E,tip:n("virtualConfig.generate")+"...",children:e.jsxs("div",{className:t.modal_content,children:[e.jsx("div",{className:t.title,children:n("virtualConfig.baseConfig")}),e.jsx("div",{className:t.scrollable_content,children:e.jsxs(Q,{form:r,preserve:!1,onFinish:ea,style:{position:"relative"},children:[e.jsx("div",{className:t.sectionHeader,children:e.jsx("div",{className:t.sectionTitle,children:n("virtualConfig.basicInfo")})}),e.jsxs("div",{className:t.nameAndType,children:[e.jsx(Q.Item,{label:n("virtualConfig.name"),required:!0,colon:!1,layout:"vertical",children:e.jsxs(fa,{children:[e.jsx(Q.Item,{name:"avatar",colon:!1,initialValue:V,className:t.form_avatar,children:e.jsxs("div",{className:t.teamAvatar,children:[!L&&e.jsx("div",{}),e.jsx("img",{src:V,alt:n("virtualConfig.avatar"),referrerPolicy:"no-referrer",onLoad:()=>_(!0),onError:a=>{a.currentTarget.src=Re,_(!0)},onClick:()=>we(!0),style:{objectFit:"cover"}},V)]})}),e.jsx(Q.Item,{label:null,name:"name",colon:!1,initialValue:n("virtualConfig.customName")+Je(),className:t.form_avatar,children:e.jsx(je,{className:t.inputField,maxLength:20,placeholder:n("virtualConfig.placeholderName"),onBlur:a=>{const i=(a.target.value??"").trim();r.setFieldsValue({botName:i})}})})]})}),e.jsx(Q.Item,{name:"botType",colon:!1,label:n("virtualConfig.type"),layout:"vertical",children:e.jsx(q,{suffixIcon:e.jsx("img",{src:ee,className:"w-4 h-4 "}),className:t.inputField,placeholder:n("virtualConfig.placeholderType"),options:u,fieldNames:{label:"name",value:"key"},allowClear:!0,showSearch:!0,optionFilterProp:"label",filterOption:(a,i)=>(typeof(i==null?void 0:i.name)=="string"?i.name:"").toLowerCase().includes(a.toLowerCase())})})]}),e.jsx(Q.Item,{name:"botDesc",label:n("virtualConfig.description"),required:!0,labelCol:{span:24},wrapperCol:{span:24},validateTrigger:"onBlur",className:t.form_area,children:e.jsx(je.TextArea,{showCount:!0,maxLength:200,className:t.input_area,autoSize:{minRows:7,maxRows:7},placeholder:n("virtualConfig.placeholderDescription")})}),e.jsx("div",{className:t.inputBottom,children:e.jsxs("div",{className:t.aiBottom,onClick:()=>{aa()},children:[e.jsx("img",{src:La,alt:""}),e.jsx("span",{children:n("virtualConfig.aiGenerate")})]})}),e.jsxs("div",{className:t.sectionHeader,children:[e.jsx("div",{className:t.sectionTitle,children:n("virtualConfig.voiceAndAvatar")}),e.jsx(re,{title:n("virtualConfig.avatarTip"),overlayStyle:{maxWidth:220,whiteSpace:"normal"},children:e.jsx("img",{className:t.sectionHelp,src:de})})]}),e.jsxs("div",{className:t.configSection,children:[e.jsxs("div",{className:t.toggleRow,children:[e.jsx("span",{className:t.toggleLabel,children:n("virtualConfig.virtualHuman")}),e.jsx(re,{title:n("virtualConfig.virtualHumanTip"),children:e.jsx("img",{className:t.sectionHelp,src:de})}),e.jsx(ga,{checked:j,onChange:a=>{b(a),a?(B(0),r.setFieldValue("interactType",2),b(a)):y?(r.setFieldValue("interactType",0),b(a)):(r.setFieldValue("interactType",2),b(!0))}})]}),e.jsx("div",{className:t.sectionHeaderHelp,children:n("virtualConfig.virtualHumanTip2")}),e.jsxs("div",{className:t.toggleSwitch,children:[e.jsx("div",{className:`${t.toggleSwitchItem} ${f===0?t.toggleSwitchItemActive:""}`,onClick:()=>{B(0),m(d||c[0].sceneId),U(c[0].defaultVCN||"")},children:n("virtualConfig.broadcast")}),e.jsx("div",{className:`${t.toggleSwitchItem} ${f===1?t.toggleSwitchItemActive:""}`,onClick:()=>{B(1),z(k||X[0].sceneId),U(X[0].defaultVCN||"")},children:n("virtualConfig.call")})]}),j&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx("span",{className:t.toggleLabel,children:n("virtualConfig.virtualHumanAvatar")}),e.jsxs("div",{role:"button",tabIndex:0,onClick:Ie,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&Ie()},className:t.summaryRow,children:[e.jsx("div",{className:t.summaryLeft,children:e.jsxs("div",{className:t.optionInfo,children:[e.jsx("img",{className:t.summaryAvatar,src:((Te=Y.find(a=>a.sceneId===$))==null?void 0:Te.avatar)||Re,alt:""}),e.jsx("div",{className:t.summaryName,children:e.jsx("div",{className:t.summaryNameText,children:((Qe=Y.find(a=>a.sceneId===$))==null?void 0:Qe.name)??n("virtualConfig.defaultVoice")})})]})}),e.jsx("img",{className:t.summaryAction,src:Aa,alt:""})]})]})]}),e.jsxs("div",{className:`${t.configSection} ${t.voiceSection}`,children:[e.jsxs("div",{className:t.toggleRow,children:[e.jsx("span",{className:t.toggleLabel,children:n("virtualConfig.roleVoice")}),e.jsx(re,{title:n("virtualConfig.roleVoiceTip"),children:e.jsx("img",{className:t.sectionHelp,src:de})})]}),e.jsx("div",{className:t.sectionHeaderHelp,children:n("virtualConfig.roleVoiceTip2")}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx("span",{className:t.toggleLabel,children:n("virtualConfig.currentVoice")}),e.jsxs("div",{role:"button",tabIndex:0,onClick:Se,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&Se()},className:t.summaryRow,children:[e.jsx("div",{className:t.summaryLeft,children:e.jsxs("div",{className:t.voicePill,children:[e.jsx("div",{className:t.voiceIcon,"aria-hidden":"true",children:e.jsx("img",{src:Ue,alt:"",loading:"lazy",onError:a=>{a.currentTarget.onerror=null,a.currentTarget.src=Ue}})}),e.jsx("span",{className:t.summaryName,children:oa()})]})}),e.jsx("img",{className:t.summaryActionVcn,src:Ta,alt:""})]})]})]}),K&&e.jsxs(Ee,{open:K,onCancel:()=>{ie(!1),pe(""),ve(null),G(!1)},footer:null,width:980,centered:!0,maskClosable:!0,destroyOnClose:!0,afterClose:qe,title:null,closable:!0,bodyStyle:{padding:0},children:[e.jsxs("div",{className:t.avatarModalWrap,children:[e.jsx("div",{className:t.avatarModalHeader,children:e.jsx("div",{className:t.avatarModalTitle,children:n("virtualConfig.avatarModal.virtualHumanAvatar")})}),e.jsxs("div",{className:t.avatarModalBody,children:[e.jsxs("div",{className:t.avatarListPane,children:[f===0&&e.jsxs("div",{className:t.avatarFilterRow,children:[e.jsxs("span",{className:t.filterLabel,children:[n("virtualConfig.avatarModal.filterByType"),"："]}),e.jsx(q,{suffixIcon:e.jsx("img",{src:ee,className:"w-4 h-4 "}),style:{width:160},className:t.filterSelect,value:ne,options:[{label:n("virtualConfig.avatarModal.filterByGender"),value:"all"},{label:n("virtualConfig.avatarModal.filterByGenderMale"),value:"male"},{label:n("virtualConfig.avatarModal.filterByGenderFemale"),value:"female"}],onChange:a=>ue(a)}),e.jsx(q,{suffixIcon:e.jsx("img",{src:ee,className:"w-4 h-4 "}),style:{width:160},className:t.filterSelect,value:se,options:[{label:n("virtualConfig.avatarModal.filterByPosture"),value:"all"},{label:n("virtualConfig.avatarModal.filterByPostureFull"),value:"full"},{label:n("virtualConfig.avatarModal.filterByPostureHalf"),value:"half"}],onChange:a=>fe(a)}),e.jsx(q,{suffixIcon:e.jsx("img",{src:ee,className:"w-4 h-4 "}),style:{width:160},className:t.filterSelect,value:le,options:[{label:n("virtualConfig.avatarModal.filterByScene"),value:"all"},{label:n("virtualConfig.avatarModal.filterBySceneAIAnchor"),value:"ai_host"},{label:n("virtualConfig.avatarModal.filterBySceneEducationAndLearning"),value:"education"},{label:n("virtualConfig.avatarModal.filterBySceneDigitalEmployee"),value:"digital_staff"},{label:n("virtualConfig.avatarModal.filterBySceneCartoonCharacter"),value:"cartoon"},{label:n("virtualConfig.avatarModal.filterBySceneHistoricalFigures"),value:"historical"}],onChange:a=>ge(a)})]}),e.jsx("div",{className:t.avatarGrid,children:sa.map(a=>{const i=a.sceneId===(S||$);return e.jsxs("div",{className:t.avatarItem,role:"button",tabIndex:0,onClick:()=>{H(a.sceneId),a.defaultVCN&&xe.some(v=>v.id===a.defaultVCN)&&s(a.defaultVCN)},onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(H(a.sceneId),a.defaultVCN&&xe.some(h=>h.id===a.defaultVCN)&&s(a.defaultVCN))},children:[e.jsx("div",{className:`${t.avatarItemThumb} ${i?t.avatarItemActive:""} ${f===0?"":t.avatarItemDisabled}`,"aria-hidden":"true",children:e.jsx("img",{src:a.sampleAvatar||a.avatar||Qa,alt:""})}),e.jsx("div",{className:t.avatarName,children:a.name})]},a.sceneId)})})]}),e.jsxs("div",{className:t.avatarPreviewPane,children:[e.jsxs("div",{className:t.avatarPreviewCard,children:[e.jsx("div",{className:t.avatarPreviewHeader,children:e.jsxs("div",{className:t.previewName,children:[(Fe=Y.find(a=>a.sceneId===(S||$)))==null?void 0:Fe.name,e.jsxs("span",{children:["·"," ",n("virtualConfig.avatarModal.avatarPreviewText")]})]})}),e.jsx("img",{className:`${t.avatarPreviewImage} ${f===0?"":t.avatarPreviewImageXuniren}`,src:((Pe=Y.find(a=>a.sceneId===(S||$)))==null?void 0:Pe.avatar)||Fa,alt:""})]}),e.jsx("div",{className:t.avatarPreviewCaption,children:n("virtualConfig.avatarModal.avatarPreview")})]})]})]}),e.jsxs("div",{className:t.avatarModalFooter,children:[e.jsx(ae,{onClick:()=>{ie(!1),pe(""),ve(null),G(!1)},children:n("virtualConfig.avatarModal.cancel")}),e.jsx(ae,{type:"primary",onClick:()=>{if(S&&(f===0?m(S):f===1&&z(S)),Z)P(Z);else{const a=c.find(v=>v.sceneId===S),i=a==null?void 0:a.defaultVCN;i&&xe.some(v=>v.id===i)&&P(i)}G(!1)},children:n("virtualConfig.avatarModal.confirm")})]})]}),e.jsx(Q.Item,{label:e.jsxs("div",{className:t.sectionHeader,style:{marginBottom:0},children:[e.jsx("div",{className:t.sectionTitle,children:n("virtualConfig.defaultInteraction")}),e.jsx(re,{title:n("virtualConfig.defaultInteractionTip"),children:e.jsx("img",{className:t.sectionHelp,src:de})})]}),style:{display:"none"},name:"interactType",initialValue:2,layout:"vertical",children:e.jsx(q,{suffixIcon:e.jsx("img",{src:ee,className:"w-4 h-4 "}),className:t.form_select,options:[{label:n("virtualConfig.voiceInteraction"),value:0},{label:n("virtualConfig.textInteraction"),value:1},{label:n("virtualConfig.broadcast"),value:2},{label:n("virtualConfig.call"),value:3}]})}),e.jsxs("div",{className:t.footerContiner,children:[(o==null?void 0:o.flowId)&&e.jsx("div",{className:t.footerContinerLeft,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"text-desc text-[#7F7F7F]",children:[n("workflow.nodes.flowModal.flowId"),"：",o==null?void 0:o.flowId]}),e.jsx("img",{src:Sa,className:"w-[14px] h-[14px] cursor-pointer",alt:"",onClick:()=>{pa((o==null?void 0:o.flowId)||""),I.success(n("workflow.nodes.flowModal.copySuccess"))}})]})}),e.jsxs("div",{className:t.footerContinerRight,children:[e.jsx("div",{className:t.cancelBtn,onClick:()=>{F()},children:n("virtualConfig.cancel")}),e.jsx(ae,{className:t.submitBtn,htmlType:"submit",children:n("virtualConfig.submitBtn")})]})]})]})})]})}),e.jsx(xa,{text:We,voiceName:Oe,language:$e,isPlaying:ze,setIsPlaying:ie}),Xe&&e.jsx(Ut,{icons:M,colors:O,botIcon:V,setBotIcon:Ne,botColor:"",setBotColor:"",setShowModal:we}),e.jsx(ha,{changeSpeakerModal:J,botCreateCallback:la,setBotCreateActiveV:A,botCreateActiveV:g,showSpeakerModal:me,mySpeaker:he,setMySpeaker:ia})]})};export{sn as V,Ta as e};
