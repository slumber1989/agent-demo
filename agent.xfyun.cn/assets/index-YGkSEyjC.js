const O="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3csvg%20t='1745247371094'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='3418'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='16'%20height='16'%3e%3cpath%20d='M512%2064c247.424%200%20448%20200.576%20448%20448S759.424%20960%20512%20960%2064%20759.424%2064%20512%20264.576%2064%20512%2064z%20m64%20608H448v128h128V672z%20m32-448H416l64%20400h64l64-400z'%20fill='%23E6960C'%20p-id='3419'%3e%3c/path%3e%3c/svg%3e",y={},N={};function p(e,i,c){this.bucketName=e||"",this.bucketUrl=i||"",this.signatureUrl=c||"/developer/user/fileToken",this.uploadUrl=c||"/developer/user/fileToken",this.fileUrl="",this.createHttpRequest=function(s){let t={};return window.XMLHttpRequest?t=new XMLHttpRequest:t=new ActiveXObject("Microsoft.XMLHTTP"),XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(r){function n(d){return d.charCodeAt(0)&255}const l=Array.prototype.map.call(r,n),a=new Uint8Array(l);this.send(a.buffer)}),t},this.getFileName=function(s){var l,a;const r=((l=s==null?void 0:s.name)==null?void 0:l.match(/(.*)\./g))[0].toString(),n=(a=s==null?void 0:s.name)==null?void 0:a.substring(r.length);return Date.now()+"."+n}}p.prototype.getSignature=function(e,i,c,s){const t=this.createHttpRequest();e!=null&&e.uuid&&(N[e.uuid]=t),t.open("POST",this.signatureUrl);const r=new FormData;e!=null&&e.chooseSendFile||r.append("fileName",e.fileName),e!=null&&e.chooseSendFile&&r.append("file",e.file);const n=function(){if(t.readyState===4)if(t.status===200){const a=JSON.parse(t==null?void 0:t.responseText);if((a==null?void 0:a.code)===0)i({msg:JSON.parse(t.responseText)});else{c({msg:t.responseText,file});return}}else c({msg:t.responseText})},l=function(a){a.lengthComputable&&s(a.loaded/a.total)};t.onreadystatechange=n,t.upload.onprogress=l,t.send(r)};p.prototype.uploadFile=function(e,i,c,s){const t=this;this.getSignature({fileName:t.getFileName(e.file),file:e.file,uuid:e==null?void 0:e.uuid,chooseSendFile:e==null?void 0:e.chooseSendFile},r=>{const{authorization:n,date:l,digest:a,url:d,host:f}=r.msg.data,o="POST",m=e.file||{},R=`${d}&authorization=${Base64.encode(n)}&date=${l}&host=${f}`,u=t.createHttpRequest();e!=null&&e.uuid&&(y[e.uuid]=u),u.open(o,R,!0),u.setRequestHeader("Authorization",n);const T=function(h){var w;if(u.readyState===4)if(u.status===200)try{const g=JSON.parse(u.responseText);if((g==null?void 0:g.code)===0){const S=(w=JSON.parse(u.responseText).data)==null?void 0:w.link;i({msg:S,file:m,url:S})}else{c({msg:u.responseText,file:m});return}}catch(g){console.warn("fileORSC PARSE ERR",g)}else c({msg:u.responseText,file:m})},F=function(h){h.lengthComputable&&s(h.loaded/h.total)},H=function(){console.log("上传请求已取消"),y[e==null?void 0:e.uuid]&&delete y[e.uuid]};u.onabort=H,u.onreadystatechange=T,u.upload.onprogress=F;const x=new FileReader;x.onload=h=>{const w=h.target.result;u.send(w)},x.readAsArrayBuffer(m)},()=>{console.error("上传失败！")},()=>{})};p.prototype.batchUpload=function(e,i,c,s){var t=this,r=[],n=[],l=0;if(e.length==0){console.warn("批量上传列表为空");return}var a=function(o){r.push(o),s(r.length/e.length),r.length==e.length?i(r):(l++,t.uploadFile({file:e[l]},a,d,f))},d=function(o){n.push(o.file),r.length+n.length==e.length&&c({errorList:n,successList:r})},f=function(o){};s(0),t.uploadFile({file:e[l]},a,d,f)};p.prototype.uploadFileLocal=function(e,i,c,s){const t="post",r=e.file||{},n=new FormData,l=this;n.append("file",r);const a=l.createHttpRequest();a.open(t,this.uploadUrl,!0);const d=function(){a.readyState===4&&(a.status===200?i({msg:a.responseText,file:r}):c({msg:a.responseText,file:r}))},f=function(o){o.lengthComputable&&s(o.loaded/o.total)};a.onreadystatechange=d,a.upload.onprogress=f,a.send(n)};p.prototype.getFileUrl=function(){};export{p as X,y as u,O as w};
