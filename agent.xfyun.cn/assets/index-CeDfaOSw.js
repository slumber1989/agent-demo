import{f as q,j as a,D as W,d as X,b7 as Z,G as x,r as m,av as J,dV as K,dW as Q,x as B,aC as Y,M as D,I as G,dX as ee,bd as se}from"./index-ChJwsExv.js";import{I as te}from"./index-Dd7kKHqh.js";import{S as ae}from"./SpaceButton-Rreq134p.js";const ce="/assets/createSpaceBg-CTFgIfkp.png",re="_spaceModal_1bxkh_1",ne="_infoBanner_1bxkh_25",oe="_bannerIcon_1bxkh_38",le="_bannerText_1bxkh_53",pe="_form_1bxkh_63",de="_buttonGroup_1bxkh_63",me="_upgradeButton_1bxkh_71",ue="_footerItem_1bxkh_152",o={spaceModal:re,infoBanner:ne,bannerIcon:oe,bannerText:le,form:pe,buttonGroup:de,upgradeButton:me,footerItem:ue},ie="_spaceButtonGroup_dlfmc_1",fe="_button_dlfmc_11",_e="_vertical_dlfmc_18",xe="_noSplit_dlfmc_24",he="_loading_dlfmc_52",N={spaceButtonGroup:ie,button:fe,vertical:_e,noSplit:xe,"size-large":"_size-large_dlfmc_27","size-middle":"_size-middle_dlfmc_35","size-small":"_size-small_dlfmc_43",loading:he,"ant-tooltip-content":"_ant-tooltip-content_dlfmc_56","ant-tooltip-inner":"_ant-tooltip-inner_dlfmc_56"},be=({buttons:p,userRole:h,className:b,size:l="middle",onButtonClick:c,style:s,vertical:t=!1,split:S=!0,defaultPermissionFailureBehavior:y})=>{const I=(n,i)=>a.jsx(ae,{config:n,userRole:h,size:l,onClick:c,inGroup:!0,defaultPermissionFailureBehavior:y},n.key),d=p.map((n,i)=>I(n)).filter(n=>n!==null);if(d.length===0)return null;const u=q(N.spaceButtonGroup,{[N.vertical]:t,[N.noSplit]:!S,[N[`size-${l}`]]:!0},b);return a.jsx(W.Group,{className:u,size:l,style:s,children:d})},A={spaceName:{pattern:/^[a-zA-Z0-9\u4e00-\u9fa5_]+$/,message:"仅支持中英文、数字、下划线"},phoneNumber:{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}},{TextArea:ge}=G,C="https://openres.xfyun.cn/xfyundoc/2025-07-28/1b05a0cf-e3b5-424c-8fd7-7a527488ab70/1753700397686/spaceAvatar.png",Ie=({open:p,onClose:h,onSubmit:b,onSuccess:l,mode:c="create",initialData:s})=>{const{t}=X(),{checkName:S,createSpace:y,editSpace:I}=Z(),[d]=x.useForm(),[u,n]=m.useState((s==null?void 0:s.avatarUrl)||C),[i,v]=m.useState((s==null?void 0:s.name)||""),[U,k]=m.useState((s==null?void 0:s.description)||""),{spaceType:E,setSpaceName:F,setSpaceAvatar:R,setSpaceId:z}=J(),[O,w]=m.useState(!1),[f,M]=m.useState(!1);m.useEffect(()=>{p&&s&&(n(s.avatarUrl||C),v(s.name||""),k(s.description||"")),p&&H()},[p,s]);const P={create:{handler:y,postProcess:async e=>{z(e),await se(e)}},edit:{handler:I,postProcess:async()=>{}}},$=async e=>{try{const r={name:i,id:c==="create"?"":s==null?void 0:s.id};if(await S(r))throw console.log("空间名已存在"),new Error(t("space.spaceNameExists"));const g=P[c],_=await g.handler({...s,...e});await g.postProcess(_)}catch(r){throw r}},L=async()=>{try{const r={...await d.validateFields(),avatarUrl:u};b?b(r):(await $(r),B.success(t(c==="create"?"space.createSuccess":"space.updateSuccess")),j(),l==null||l(),R(u),F(i))}catch(e){B.error((e==null?void 0:e.msg)||(e==null?void 0:e.message)||t("space.createFailed")),console.error("表单验证失败:",e)}},H=async()=>{try{const e=await K(),r=await Q(),T=Array.isArray(r)?r.some(_=>_.menu==="FREE_EDITION"):r.menu==="FREE_EDITION",g=Array.isArray(r)?r.some(_=>_.menu==="PERSONAL_EDITION"):r.menu==="PERSONAL_EDITION";(T&&(e==null?void 0:e.length)>=1&&E==="personal"&&c==="create"||g&&E==="personal"&&(e==null?void 0:e.length)>=10&&c==="create")&&M(!0)}catch(e){console.log(e,"error"),e.code!==8e4?B.error((e==null?void 0:e.desc)||(e==null?void 0:e.msg)):Y()}},j=()=>{d.resetFields(),v(""),k(""),n(C),h()},V=[{key:"cancel",text:t("space.cancel"),type:"default",onClick:()=>j()},{key:"submit",text:t(f&&c==="create"?"space.createLimitReached":c==="create"?"space.confirm":"space.save"),type:f&&c==="create"?"default":"primary",disabled:f&&c==="create",onClick:()=>{f&&c==="create"||L()}}];return a.jsxs(a.Fragment,{children:[a.jsxs(D,{title:t(c==="create"?"space.createSpace":"space.editSpace"),open:p,onCancel:j,footer:null,width:648,className:o.spaceModal,destroyOnClose:!0,maskClosable:!1,keyboard:!1,zIndex:999,children:[a.jsxs("div",{className:o.infoBanner,style:{backgroundImage:`url(${ce})`},children:[a.jsx("div",{className:o.bannerIcon,children:a.jsx(te,{name:i,botDesc:U,coverUrl:u,setCoverUrl:n})}),a.jsx("div",{className:o.bannerText,children:t("space.bannerText")})]}),a.jsxs(x,{form:d,layout:"vertical",className:o.form,initialValues:s,onValuesChange:e=>{e.name!==void 0&&v(e.name||""),e.description!==void 0&&k(e.description||"")},children:[a.jsx(x.Item,{label:t("space.spaceName"),name:"name",rules:[{required:!0,message:t("space.pleaseEnterSpaceName")},{max:50,message:t("space.spaceNameMaxLength")},{pattern:A.spaceName.pattern,message:A.spaceName.message}],children:a.jsx(G,{placeholder:t("space.pleaseEnterSpaceName"),maxLength:50,showCount:!0})}),a.jsx(x.Item,{label:t("space.description"),name:"description",rules:[{max:2e3,message:t("space.descriptionMaxLength")}],children:a.jsx(ge,{className:"xingchen-textarea xingchen-space-textarea",autoSize:{minRows:3,maxRows:3},placeholder:t("space.describeSpace"),maxLength:2e3,showCount:!0})}),a.jsx(x.Item,{className:o.footerItem,children:a.jsxs("div",{className:o.buttonGroup,children:[f&&a.jsx("div",{className:o.upgradeButton,onClick:()=>{w(!0),h()},children:t("space.goUpgrade")}),a.jsx(be,{buttons:V,size:"large"})]})})]})]}),a.jsx(ee,{visible:O,onCancel:()=>w(!1)})]})};export{be as B,Ie as S,A as p};
